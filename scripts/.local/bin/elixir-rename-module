#!/usr/bin/env ruby

module_name = ARGV[0]
dir = ARGV[1]

pattern = "(defmodule )(#{module_name})() +do"

matches = `rg -w --type elixir --no-heading '#{pattern}' #{dir} --replace '$2'`

matches.split.map do |line|
  file, name = line.split(':')

  puts "Replace #{name} with:"

  replacement = STDIN.gets.chomp

  break if replacement.empty?

  puts `rg -w --files-with-matches #{name}`
end
